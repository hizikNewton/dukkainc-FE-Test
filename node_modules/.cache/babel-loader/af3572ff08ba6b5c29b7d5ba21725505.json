{"ast":null,"code":"var _jsxFileName = \"/home/ire/Dev/frontend-engineer-interview/app/src/components/FormValidator.tsx\";\nimport React, { Component } from \"react\";\nimport { FormCtx, ValidationCtx } from \"../context\";\nimport { ValidateData } from \"../utils/validate\";\nimport { Spinner } from \"./spinner\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport class FormValidator extends Component {\n  constructor(props) {\n    super(props);\n    this.context = void 0;\n\n    this.getMessagesForField = field => {\n      return this.state.formSubmitted || this.state.dirty[field] ? this.state.errors[field] || [] : [];\n    };\n\n    this.handleChange = ev => {\n      var _this$props$setErrorS, _this$props;\n\n      let name = ev.target.name;\n      this.setState(state => {\n        state.dirty[name] = true;\n      });\n      (_this$props$setErrorS = (_this$props = this.props).setErrorState) === null || _this$props$setErrorS === void 0 ? void 0 : _this$props$setErrorS.call(_this$props, this.state.errors);\n    };\n\n    this.handleClick = () => {\n      this.setState({\n        formSubmitted: true\n      }, () => {\n        if (this.formValid) {\n          let formErrors = this.props.validateForm(this.props.data);\n\n          if (formErrors.length === 0) {\n            this.context.submitForm(this.props.data);\n          }\n        }\n      });\n    };\n\n    this.state = {\n      errors: {},\n      dirty: {},\n      formSubmitted: false,\n      getMessagesForField: this.getMessagesForField\n    };\n  }\n\n  static getDerivedStateFromProps(props, state) {\n    state.errors = ValidateData(props.data, props.rules);\n\n    if (state.formSubmitted && Object.keys(state.errors).length === 0) {\n      let formErrors = props.validateForm(props.data);\n\n      if (formErrors.length > 0) {\n        state.errors.form = formErrors;\n      }\n    }\n\n    return state;\n  }\n\n  get formValid() {\n    return Object.keys(this.state.errors).length === 0;\n  }\n\n  getButtonClasses() {\n    return this.state.formSubmitted && !this.formValid ? \"btn-danger\" : \"btn-primary\";\n  }\n\n  render() {\n    const {\n      message,\n      loading\n    } = this.context;\n    return /*#__PURE__*/_jsxDEV(React.Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(ValidationCtx.Provider, {\n        value: this.state,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: message\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          onChange: this.handleChange,\n          children: this.props.children\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: `btn ${this.getButtonClasses()}`,\n          onClick: this.handleClick,\n          disabled: this.state.formSubmitted && !this.formValid,\n          children: [this.props.submitText, loading && /*#__PURE__*/_jsxDEV(Spinner, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 102,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 7\n    }, this);\n  }\n\n}\nFormValidator.defaultProps = {\n  submitText: \"Submit\"\n};\nFormValidator.contextType = FormCtx;","map":{"version":3,"sources":["/home/ire/Dev/frontend-engineer-interview/app/src/components/FormValidator.tsx"],"names":["React","Component","FormCtx","ValidationCtx","ValidateData","Spinner","FormValidator","constructor","props","context","getMessagesForField","field","state","formSubmitted","dirty","errors","handleChange","ev","name","target","setState","setErrorState","handleClick","formValid","formErrors","validateForm","data","length","submitForm","getDerivedStateFromProps","rules","Object","keys","form","getButtonClasses","render","message","loading","children","submitText","defaultProps","contextType"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { FormCtx, ValidationCtx } from \"../context\";\nimport { IData, IRule, ValidateData } from \"../utils/validate\";\nimport { Spinner } from \"./spinner\";\n\ntype errors = Array<string>;\n\ninterface Props {\n  data: any;\n  rules: IRule;\n  validateForm(data: IData): errors;\n  setErrorState?: (error: any) => void;\n  submitText?: string;\n}\ninterface State {\n  errors: {\n    [fields: string]: any;\n  };\n  dirty: {\n    [fields: string]: any;\n  };\n  formSubmitted: boolean;\n  getMessagesForField: (field: string) => [];\n}\n\nexport class FormValidator extends Component<Props, State> {\n  static defaultProps = {\n    submitText: \"Submit\",\n  };\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      errors: {},\n      dirty: {},\n      formSubmitted: false,\n      getMessagesForField: this.getMessagesForField,\n    };\n  }\n  static contextType = FormCtx;\n  context!: React.ContextType<typeof FormCtx>;\n\n  static getDerivedStateFromProps(props: Props, state: State) {\n    state.errors = ValidateData(props.data, props.rules);\n    if (state.formSubmitted && Object.keys(state.errors).length === 0) {\n      let formErrors = props.validateForm(props.data);\n      if (formErrors.length > 0) {\n        state.errors.form = formErrors;\n      }\n    }\n    return state;\n  }\n  get formValid() {\n    return Object.keys(this.state.errors).length === 0;\n  }\n\n  getMessagesForField = (field: string) => {\n    return this.state.formSubmitted || this.state.dirty[field]\n      ? this.state.errors[field] || []\n      : [];\n  };\n\n  handleChange = (ev: React.ChangeEvent<HTMLInputElement>) => {\n    let name = ev.target.name;\n    this.setState((state) => {\n      state.dirty[name] = true;\n    });\n    this.props.setErrorState?.(this.state.errors);\n  };\n\n  handleClick = () => {\n    this.setState({ formSubmitted: true }, () => {\n      if (this.formValid) {\n        let formErrors = this.props.validateForm(this.props.data);\n        if (formErrors.length === 0) {\n          this.context.submitForm(this.props.data);\n        }\n      }\n    });\n  };\n\n  getButtonClasses() {\n    return this.state.formSubmitted && !this.formValid\n      ? \"btn-danger\"\n      : \"btn-primary\";\n  }\n\n  render() {\n    const { message, loading } = this.context;\n    return (\n      <React.Fragment>\n        <ValidationCtx.Provider value={this.state}>\n          <div>{message}</div>\n          <div onChange={this.handleChange}>{this.props.children}</div>\n        </ValidationCtx.Provider>\n        <div>\n          <button\n            className={`btn ${this.getButtonClasses()}`}\n            onClick={this.handleClick}\n            disabled={this.state.formSubmitted && !this.formValid}\n          >\n            {this.props.submitText}\n            {loading && <Spinner />}\n          </button>\n        </div>\n      </React.Fragment>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}